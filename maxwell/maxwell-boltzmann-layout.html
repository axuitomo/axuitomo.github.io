<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>麦克斯韦-玻尔兹曼速度分布</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <!-- 引入MathJax用于数学公式渲染 -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- 配置Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#8B5CF6',
                        hot: '#EF4444',
                        cold: '#3B82F6',
                        medium: '#F59E0B',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                @apply shadow-lg hover:shadow-xl transition-shadow duration-300;
            }
            .molecule-animation {
                @apply absolute rounded-full bg-primary/70;
            }
            .distribution-hot {
                @apply text-hot;
            }
            .distribution-medium {
                @apply text-medium;
            }
            .distribution-cold {
                @apply text-cold;
            }
            .math-container {
                @apply my-4 text-center;
            }
            .info-card {
                @apply bg-white/90 backdrop-blur-sm p-3 rounded-lg border border-gray-200 shadow-md;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800">
    <!-- 页面标题 -->
    <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white shadow-md">
        <div class="container mx-auto px-4 py-6">
            <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-center">分子动理论的"速度"分布</h1>
            <p class="text-center mt-2 text-blue-100">麦克斯韦-玻尔兹曼速度分布律可视化</p>
        </div>
    </header>

    <!-- 主要内容 -->
    <main class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- 左侧控制面板 -->
            <div class="lg:col-span-1 space-y-6">
                <!-- 温度控制卡片 -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fa fa-thermometer-half mr-2 text-primary"></i>温度控制
                    </h2>
                    
                    <div class="space-y-6">
                        <!-- 低温控制 -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <label for="coldTemp" class="font-medium flex items-center text-cold">
                                    <i class="fa fa-snowflake-o mr-2"></i>低温 \( T_1 \)
                                </label>
                                <span id="coldTempValue" class="bg-cold/10 text-cold px-2 py-1 rounded text-sm font-medium">100 K</span>
                            </div>
                            <input 
                                type="range" 
                                id="coldTemp" 
                                min="50" 
                                max="300" 
                                value="100" 
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                            >
                        </div>
                        
                        <!-- 中温控制 -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <label for="mediumTemp" class="font-medium flex items-center text-medium">
                                    <i class="fa fa-sun-o mr-2"></i>中温 \( T_2 \)
                                </label>
                                <span id="mediumTempValue" class="bg-medium/10 text-medium px-2 py-1 rounded text-sm font-medium">300 K</span>
                            </div>
                            <input 
                                type="range" 
                                id="mediumTemp" 
                                min="150" 
                                max="600" 
                                value="300" 
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                            >
                        </div>
                        
                        <!-- 高温控制 -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <label for="hotTemp" class="font-medium flex items-center text-hot">
                                    <i class="fa fa-fire mr-2"></i>高温 \( T_3 \)
                                </label>
                                <span id="hotTempValue" class="bg-hot/10 text-hot px-2 py-1 rounded text-sm font-medium">600 K</span>
                            </div>
                            <input 
                                type="range" 
                                id="hotTemp" 
                                min="400" 
                                max="1000" 
                                value="600" 
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                            >
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <button id="startSimulation" class="w-full bg-primary hover:bg-primary/90 text-white py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                            <i class="fa fa-play mr-2"></i>开始分子模拟
                        </button>
                        <button id="pauseSimulation" class="w-full mt-3 bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center hidden">
                            <i class="fa fa-pause mr-2"></i>暂停模拟
                        </button>
                    </div>
                </div>
                
                <!-- 统计数据卡片 -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fa fa-bar-chart mr-2 text-accent"></i>速度统计
                    </h2>
                    
                    <div class="space-y-4">
                        <div class="distribution-cold">
                            <p class="text-sm text-gray-500">低温气体</p>
                            <div class="flex justify-between items-center">
                                <span class="text-sm">最概然速度:</span>
                                <span class="font-medium" id="coldMostProbable">393 m/s</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm">平均速度:</span>
                                <span class="font-medium" id="coldAverage">446 m/s</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm">方均根速度:</span>
                                <span class="font-medium" id="coldRms">493 m/s</span>
                            </div>
                        </div>
                        
                        <div class="distribution-medium">
                            <p class="text-sm text-gray-500">中温气体</p>
                            <div class="flex justify-between items-center">
                                <span class="text-sm">最概然速度:</span>
                                <span class="font-medium" id="mediumMostProbable">681 m/s</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm">平均速度:</span>
                                <span class="font-medium" id="mediumAverage">774 m/s</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm">方均根速度:</span>
                                <span class="font-medium" id="mediumRms">853 m/s</span>
                            </div>
                        </div>
                        
                        <div class="distribution-hot">
                            <p class="text-sm text-gray-500">高温气体</p>
                            <div class="flex justify-between items-center">
                                <span class="text-sm">最概然速度:</span>
                                <span class="font-medium" id="hotMostProbable">965 m/s</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm">平均速度:</span>
                                <span class="font-medium" id="hotAverage">1095 m/s</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm">方均根速度:</span>
                                <span class="font-medium" id="hotRms">1205 m/s</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 右侧图表和说明 -->
            <div class="lg:col-span-2 space-y-6">
                <!-- 分子模拟容器 -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fa fa-microchip mr-2 text-primary"></i>分子运动模拟
                    </h2>
                    
                    <div id="moleculeContainer" class="relative w-full h-64 bg-gray-50 rounded-lg overflow-hidden border border-gray-200">
                        <!-- 分子将通过JavaScript动态生成 -->
                        <div class="absolute inset-0 flex items-center justify-center text-gray-400" id="moleculePlaceholder">
                            <p>点击"开始分子模拟"按钮查看分子运动</p>
                        </div>
                    </div>
                    
                    <div class="mt-4 grid grid-cols-3 gap-4 text-center text-sm">
                        <div class="bg-cold/10 rounded-lg p-2 distribution-cold">
                            <p>低温气体分子</p>
                            <p class="font-medium">速度较慢</p>
                        </div>
                        <div class="bg-medium/10 rounded-lg p-2 distribution-medium">
                            <p>中温气体分子</p>
                            <p class="font-medium">速度中等</p>
                        </div>
                        <div class="bg-hot/10 rounded-lg p-2 distribution-hot">
                            <p>高温气体分子</p>
                            <p class="font-medium">速度较快</p>
                        </div>
                    </div>
                </div>
                
                <!-- 速度分布图和说明组合 -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fa fa-line-chart mr-2 text-primary"></i>麦克斯韦-玻尔兹曼速度分布
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <!-- 速度分布图 -->
                        <div class="md:col-span-3 relative" style="height: 400px;">
                            <canvas id="velocityChart"></canvas>
                            
                            <!-- 动画状态指示器 -->
                            <div id="animationStatus" class="hidden absolute top-4 right-4 bg-primary/90 text-white px-3 py-1 rounded-full text-sm">
                                <i class="fa fa-spinner fa-spin mr-1"></i>更新中...
                            </div>
                        </div>
                        
                        <!-- 分布说明（移至右侧，不再遮挡图表） -->
                        <div class="md:col-span-1 info-card">
                            <h3 class="font-medium text-sm mb-2">分布特征</h3>
                            <ul class="text-xs space-y-2">
                                <li class="flex items-start">
                                    <span class="w-3 h-1 mt-1.5 mr-2 inline-block bg-cold"></span>
                                    <span>低温: 峰值高且靠左（分子速度整体较慢）</span>
                                </li>
                                <li class="flex items-start">
                                    <span class="w-3 h-1 mt-1.5 mr-2 inline-block bg-medium"></span>
                                    <span>中温: 峰值和分布范围适中</span>
                                </li>
                                <li class="flex items-start">
                                    <span class="w-3 h-1 mt-1.5 mr-2 inline-block bg-hot"></span>
                                    <span>高温: 峰值低且靠右（分子速度整体较快）</span>
                                </li>
                                <li class="mt-3 pt-3 border-t border-gray-200">
                                    <p class="font-medium text-xs mb-1">关键观察:</p>
                                    <p class="text-xs">温度升高时，速度分布曲线向右移动，分子平均速度增大，说明温度是分子平均动能的量度。</p>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- 物理原理说明 -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fa fa-book mr-2 text-gray-700"></i>麦克斯韦-玻尔兹曼分布原理
                    </h2>
                    
                    <div class="space-y-4 text-gray-700">
                        <p>麦克斯韦-玻尔兹曼速度分布描述了热平衡状态下理想气体分子速度的统计分布规律，由詹姆斯·克拉克·麦克斯韦和路德维希·玻尔兹曼提出。这一分布揭示了分子速度与其出现概率之间的数学关系，是分子动理论的重要基础。</p>
                        
                        <div class="p-4 bg-blue-50 rounded-lg border border-blue-100">
                            <h3 class="font-medium text-primary">速度分布公式</h3>
                            <p class="my-2">在热平衡状态下，速度在\( v \)附近单位速度间隔内的分子数比例为：</p>
                            <div class="math-container">
                                \[
                                f(v) = 4\pi v^2 \left( \frac{m}{2\pi k T} \right)^{3/2} e^{-\frac{mv^2}{2kT}}
                                \]
                            </div>
                            <p class="text-sm mt-2">其中：
                                \( m \)为分子质量，
                                \( k \)为玻尔兹曼常数（\( k = 1.38 \times 10^{-23} \, \text{J/K} \)），
                                \( T \)为热力学温度
                            </p>
                        </div>
                        
                        <h3 class="font-medium text-lg mt-2">温度与分子动能的关系</h3>
                        <p>温度是分子平均动能的量度，这一关系可以通过以下几点理解：</p>
                        <ul class="list-disc pl-5 space-y-2 mt-2">
                            <li>温度升高时，分子的平均动能增加，速度分布曲线向右移动</li>
                            <li>分子的平均平动动能与温度的关系为：\( \langle E_k \rangle = \frac{3}{2}kT \)</li>
                            <li>对于同一气体，温度越高，分子的平均速度越大</li>
                            <li>分布曲线始终为正，且总面积恒为1（表示所有分子的概率和为1）</li>
                        </ul>
                        
                        <h3 class="font-medium text-lg mt-2">三种特征速度</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-2">
                            <div class="bg-gray-50 p-3 rounded-lg border border-gray-200">
                                <h4 class="font-medium text-sm">最概然速度</h4>
                                <div class="math-container text-sm">
                                    \[
                                    v_p = \sqrt{\frac{2kT}{m}}
                                \]
                                </div>
                                <p class="text-xs mt-1">速度分布函数取最大值时的速度，对应分布曲线的峰值位置</p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg border border-gray-200">
                                <h4 class="font-medium text-sm">平均速度</h4>
                                <div class="math-container text-sm">
                                    \[
                                    \langle v \rangle = \sqrt{\frac{8kT}{\pi m}}
                                \]
                                </div>
                                <p class="text-xs mt-1">所有分子速度的算术平均值，用于计算分子运动的平均距离</p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg border border-gray-200">
                                <h4 class="font-medium text-sm">方均根速度</h4>
                                <div class="math-container text-sm">
                                    \[
                                    v_{\text{rms}} = \sqrt{\frac{3kT}{m}}
                                \]
                                </div>
                                <p class="text-xs mt-1">速度平方平均值的平方根，与分子动能直接相关</p>
                            </div>
                        </div>
                        
                        <div class="p-3 bg-gray-50 rounded-lg border border-gray-200 mt-4">
                            <h4 class="font-medium text-sm mb-2">分子动能与温度的关系</h4>
                            <p class="text-sm">分子的平均平动动能与温度成正比：</p>
                            <div class="math-container text-sm">
                                \[
                                \langle E_k \rangle = \frac{1}{2}m \langle v^2 \rangle = \frac{3}{2}kT
                                \]
                            </div>
                            <p class="text-xs mt-2">这一公式表明，温度确实是分子平均动能的量度，与分子的质量无关，只取决于分子的平均运动速度。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="container mx-auto px-4 py-6">
            <div class="text-center text-gray-400 text-sm">
                <p>麦克斯韦-玻尔兹曼速度分布可视化 &copy; 2023</p>
                <p class="mt-1">分子动理论的交互式演示</p>
            </div>
        </div>
    </footer>

    <script>
        // 配置MathJax
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
        
        // 物理常数
        const k = 1.38e-23; // 玻尔兹曼常数，J/K
        const m = 2.657e-26; // 氮气分子质量，kg (约为28u，1u=1.66e-27kg)
        
        // 初始温度值
        let coldTemp = 100;
        let mediumTemp = 300;
        let hotTemp = 600;
        
        // 图表和动画变量
        let velocityChart;
        let molecules = [];
        let animationId = null;
        let isAnimating = false;
        
        // DOM元素
        const coldTempSlider = document.getElementById('coldTemp');
        const mediumTempSlider = document.getElementById('mediumTemp');
        const hotTempSlider = document.getElementById('hotTemp');
        const coldTempValue = document.getElementById('coldTempValue');
        const mediumTempValue = document.getElementById('mediumTempValue');
        const hotTempValue = document.getElementById('hotTempValue');
        const startSimulationBtn = document.getElementById('startSimulation');
        const pauseSimulationBtn = document.getElementById('pauseSimulation');
        const moleculeContainer = document.getElementById('moleculeContainer');
        const moleculePlaceholder = document.getElementById('moleculePlaceholder');
        const animationStatus = document.getElementById('animationStatus');
        
        // 速度统计元素
        const speedElements = {
            coldMostProbable: document.getElementById('coldMostProbable'),
            coldAverage: document.getElementById('coldAverage'),
            coldRms: document.getElementById('coldRms'),
            mediumMostProbable: document.getElementById('mediumMostProbable'),
            mediumAverage: document.getElementById('mediumAverage'),
            mediumRms: document.getElementById('mediumRms'),
            hotMostProbable: document.getElementById('hotMostProbable'),
            hotAverage: document.getElementById('hotAverage'),
            hotRms: document.getElementById('hotRms')
        };
        
        // 计算麦克斯韦-玻尔兹曼分布
        function maxwellBoltzmann(v, T) {
            const factor = 4 * Math.PI * Math.pow(v, 2);
            const exponentFactor = Math.pow(m / (2 * Math.PI * k * T), 1.5);
            const exponent = Math.exp(-(m * Math.pow(v, 2)) / (2 * k * T));
            return factor * exponentFactor * exponent;
        }
        
        // 计算特征速度
        function calculateSpeeds(T) {
            // 最概然速度
            const mostProbable = Math.sqrt((2 * k * T) / m);
            // 平均速度
            const average = Math.sqrt((8 * k * T) / (Math.PI * m));
            // 方均根速度
            const rms = Math.sqrt((3 * k * T) / m);
            
            return {
                mostProbable,
                average,
                rms
            };
        }
        
        // 更新速度统计显示
        function updateSpeedStats() {
            const coldSpeeds = calculateSpeeds(coldTemp);
            const mediumSpeeds = calculateSpeeds(mediumTemp);
            const hotSpeeds = calculateSpeeds(hotTemp);
            
            speedElements.coldMostProbable.textContent = `${Math.round(coldSpeeds.mostProbable)} m/s`;
            speedElements.coldAverage.textContent = `${Math.round(coldSpeeds.average)} m/s`;
            speedElements.coldRms.textContent = `${Math.round(coldSpeeds.rms)} m/s`;
            
            speedElements.mediumMostProbable.textContent = `${Math.round(mediumSpeeds.mostProbable)} m/s`;
            speedElements.mediumAverage.textContent = `${Math.round(mediumSpeeds.average)} m/s`;
            speedElements.mediumRms.textContent = `${Math.round(mediumSpeeds.rms)} m/s`;
            
            speedElements.hotMostProbable.textContent = `${Math.round(hotSpeeds.mostProbable)} m/s`;
            speedElements.hotAverage.textContent = `${Math.round(hotSpeeds.average)} m/s`;
            speedElements.hotRms.textContent = `${Math.round(hotSpeeds.rms)} m/s`;
        }
        
        // 初始化速度分布图表
        function initChart() {
            const ctx = document.getElementById('velocityChart').getContext('2d');
            
            // 生成速度数据点 (0到2000 m/s)
            const velocities = Array.from({length: 100}, (_, i) => i * 20);
            
            // 计算不同温度下的分布
            const coldDistribution = velocities.map(v => maxwellBoltzmann(v, coldTemp));
            const mediumDistribution = velocities.map(v => maxwellBoltzmann(v, mediumTemp));
            const hotDistribution = velocities.map(v => maxwellBoltzmann(v, hotTemp));
            
            // 创建图表
            velocityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: velocities,
                    datasets: [
                        {
                            label: `低温 (${coldTemp} K)`,
                            data: coldDistribution,
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false,
                            pointRadius: 0
                        },
                        {
                            label: `中温 (${mediumTemp} K)`,
                            data: mediumDistribution,
                            borderColor: '#F59E0B',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false,
                            pointRadius: 0
                        },
                        {
                            label: `高温 (${hotTemp} K)`,
                            data: hotDistribution,
                            borderColor: '#EF4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: '速度 (m/s)',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            min: 0,
                            max: 2000
                        },
                        y: {
                            title: {
                                display: true,
                                text: '概率密度',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: 概率密度 = ${context.raw.toExponential(4)}`;
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 1000
                    }
                }
            });
        }
        
        // 更新图表数据
        function updateChart() {
            // 显示更新状态
            animationStatus.classList.remove('hidden');
            
            const velocities = velocityChart.data.labels;
            
            velocityChart.data.datasets[0].data = velocities.map(v => maxwellBoltzmann(v, coldTemp));
            velocityChart.data.datasets[0].label = `低温 (${coldTemp} K)`;
            
            velocityChart.data.datasets[1].data = velocities.map(v => maxwellBoltzmann(v, mediumTemp));
            velocityChart.data.datasets[1].label = `中温 (${mediumTemp} K)`;
            
            velocityChart.data.datasets[2].data = velocities.map(v => maxwellBoltzmann(v, hotTemp));
            velocityChart.data.datasets[2].label = `高温 (${hotTemp} K)`;
            
            velocityChart.update().then(() => {
                // 隐藏更新状态
                setTimeout(() => {
                    animationStatus.classList.add('hidden');
                }, 500);
            });
        }
        
        // 创建分子元素
        function createMolecules(count = 50) {
            // 清除现有分子
            molecules.forEach(mol => mol.element.remove());
            molecules = [];
            
            // 隐藏占位文本
            moleculePlaceholder.classList.add('hidden');
            
            const containerRect = moleculeContainer.getBoundingClientRect();
            const containerWidth = containerRect.width;
            const containerHeight = containerRect.height;
            
            // 创建低温分子
            for (let i = 0; i < count; i++) {
                const speedFactor = 0.5; // 低温分子速度因子
                createMolecule(containerWidth, containerHeight, speedFactor, 'bg-cold molecule-animation');
            }
            
            // 创建中温分子
            for (let i = 0; i < count; i++) {
                const speedFactor = 1.0; // 中温分子速度因子
                createMolecule(containerWidth, containerHeight, speedFactor, 'bg-medium molecule-animation');
            }
            
            // 创建高温分子
            for (let i = 0; i < count; i++) {
                const speedFactor = 1.5; // 高温分子速度因子
                createMolecule(containerWidth, containerHeight, speedFactor, 'bg-hot molecule-animation');
            }
        }
        
        // 创建单个分子
        function createMolecule(containerWidth, containerHeight, speedFactor, className) {
            const molecule = document.createElement('div');
            const size = Math.random() * 3 + 2; // 分子大小 2-5px
            
            // 随机初始位置
            const x = Math.random() * (containerWidth - size);
            const y = Math.random() * (containerHeight - size);
            
            // 随机速度和方向
            const angle = Math.random() * Math.PI * 2;
            const speed = (Math.random() * 2 + 1) * speedFactor; // 基础速度 1-3 px/帧
            const vx = Math.cos(angle) * speed;
            const vy = Math.sin(angle) * speed;
            
            molecule.className = className;
            molecule.style.width = `${size}px`;
            molecule.style.height = `${size}px`;
            molecule.style.left = `${x}px`;
            molecule.style.top = `${y}px`;
            
            moleculeContainer.appendChild(molecule);
            
            molecules.push({
                element: molecule,
                x, y, vx, vy, size
            });
        }
        
        // 更新分子位置（动画）
        function updateMolecules() {
            if (!isAnimating) return;
            
            const containerRect = moleculeContainer.getBoundingClientRect();
            const containerWidth = containerRect.width;
            const containerHeight = containerRect.height;
            
            molecules.forEach(mol => {
                // 更新位置
                mol.x += mol.vx;
                mol.y += mol.vy;
                
                // 边界碰撞检测
                if (mol.x <= 0 || mol.x + mol.size >= containerWidth) {
                    mol.vx = -mol.vx; // 水平方向反弹
                    mol.x = Math.max(0, Math.min(mol.x, containerWidth - mol.size)); // 防止超出边界
                }
                
                if (mol.y <= 0 || mol.y + mol.size >= containerHeight) {
                    mol.vy = -mol.vy; // 垂直方向反弹
                    mol.y = Math.max(0, Math.min(mol.y, containerHeight - mol.size)); // 防止超出边界
                }
                
                // 应用新位置
                mol.element.style.left = `${mol.x}px`;
                mol.element.style.top = `${mol.y}px`;
            });
            
            animationId = requestAnimationFrame(updateMolecules);
        }
        
        // 开始模拟
        function startSimulation() {
            if (isAnimating) return;
            
            isAnimating = true;
            startSimulationBtn.classList.add('hidden');
            pauseSimulationBtn.classList.remove('hidden');
            
            // 如果还没有创建分子，则创建
            if (molecules.length === 0) {
                createMolecules();
            }
            
            updateMolecules();
        }
        
        // 暂停模拟
        function pauseSimulation() {
            isAnimating = false;
            startSimulationBtn.classList.remove('hidden');
            pauseSimulationBtn.classList.add('hidden');
            
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        }
        
        // 事件监听器
        coldTempSlider.addEventListener('input', function() {
            coldTemp = parseInt(this.value);
            coldTempValue.textContent = `${coldTemp} K`;
            updateSpeedStats();
            updateChart();
        });
        
        mediumTempSlider.addEventListener('input', function() {
            mediumTemp = parseInt(this.value);
            mediumTempValue.textContent = `${mediumTemp} K`;
            updateSpeedStats();
            updateChart();
        });
        
        hotTempSlider.addEventListener('input', function() {
            hotTemp = parseInt(this.value);
            hotTempValue.textContent = `${hotTemp} K`;
            updateSpeedStats();
            updateChart();
        });
        
        startSimulationBtn.addEventListener('click', startSimulation);
        pauseSimulationBtn.addEventListener('click', pauseSimulation);
        
        // 窗口大小改变时重新计算分子位置
        window.addEventListener('resize', function() {
            const wasAnimating = isAnimating;
            if (wasAnimating) {
                pauseSimulation();
            }
            
            // 重新创建分子以适应新的容器大小
            if (molecules.length > 0) {
                createMolecules();
            }
            
            if (wasAnimating) {
                startSimulation();
            }
        });
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            updateSpeedStats();
            initChart();
            
            // 等待MathJax加载完成后重新渲染
            if (window.MathJax) {
                MathJax.typesetPromise().catch(err => console.error('MathJax渲染错误:', err));
            }
        });
    </script>
</body>
</html>
    